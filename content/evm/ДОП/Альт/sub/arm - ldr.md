---
title: Команда ldr в arm ассемблере
---
# Введение

Команда `ldr` (load register) используется в ассемблере для загрузки данных из памяти в регистр процессора. Она является одной из ключевых команд для работы с памятью и обеспечивает доступ к данным, хранящимся в различных адресах. В этой статье мы подробно рассмотрим работу команды `ldr`, её синтаксис, различные варианты использования и примеры.

# Основная часть

## Синтаксис команды `ldr`

Команда `ldr` загружает значение из памяти в регистр. Общий синтаксис команды `ldr` следующий:

```assembly
ldr destination, [source]
```

Где `destination` (назначение) — это регистр, в который загружается значение, а `source` (источник) — это адрес памяти, из которого это значение загружается. Адрес памяти может быть задан различными способами.

### Пример 1: Простая загрузка из памяти

Рассмотрим простой пример, где значение загружается из памяти по адресу, хранящемуся в регистре:

```assembly
ldr x0, [x1]
```

В этом примере значение, хранящееся по адресу, указанному в регистре `x1`, загружается в регистр `x0`.

### Пример 2: Загрузка с непосредственным смещением

Команда `ldr` поддерживает загрузку со смещением от базового адреса. Например:

```assembly
ldr x0, [x1, #4]
```

В этом примере значение загружается из памяти по адресу `x1 + 4` в регистр `x0`. Смещение `#4` добавляется к значению в регистре `x1` для получения итогового адреса.

### Пример 3: Загрузка с постинкрементом

Команда `ldr` также может использовать постинкремент, который увеличивает значение регистра после загрузки:

```assembly
ldr x0, [x1], #4
```

В этом примере значение загружается из памяти по адресу, указанному в регистре `x1`, в регистр `x0`, а затем `x1` увеличивается на 4.

### Пример 4: Загрузка с прединкрементом

Существуют также операции с прединкрементом, когда смещение добавляется к регистру до выполнения загрузки:

```assembly
ldr x0, [x1, #4]!
```

В этом примере смещение `#4` сначала добавляется к `x1`, и затем значение загружается из нового адреса в регистр `x0`.

### Пример 5: Загрузка по регистровому индексу

Вместо непосредственного значения смещения можно использовать другой регистр:

```assembly
ldr x0, [x1, x2]
```

В этом примере значение загружается из памяти по адресу, равному сумме значений регистров `x1` и `x2`.

### Пример 6: Загрузка по регистровому индексу с масштабированием

Иногда нужно масштабировать индекс перед добавлением его к базовому адресу:

```assembly
ldr x0, [x1, x2, lsl #3]
```

В этом примере значение из `x2` сначала сдвигается влево на 3 бита (что эквивалентно умножению на 8), и затем это значение добавляется к `x1` для получения итогового адреса, из которого загружается значение в регистр `x0`.

## Практические примеры

### Пример 1: Чтение значения из массива

```assembly
mov x1, #arr    // Загружаем адрес начала массива в регистр x1
ldr x0, [x1, #8] // Загружаем третий элемент массива в регистр x0 (индексация с 0)
```

### Пример 2: Итерация по массиву

```assembly
mov x1, #arr    // Загружаем адрес начала массива в регистр x1
mov x2, #0      // Инициализируем индекс
loop:
ldr x0, [x1, x2, lsl #3] // Загружаем элемент массива с индексом x2 в регистр x0
add x2, x2, #1           // Увеличиваем индекс
cmp x2, #10              // Сравниваем индекс с размером массива
blt loop                // Повторяем цикл, если x2 < 10
```

### Пример 3: Обработка данных из структуры

```assembly
mov x1, #struct_ptr  // Адрес структуры в регистре x1
ldr x0, [x1, #offset] // Загружаем значение поля структуры со смещением offset
```

# Вывод

Команда `ldr` является критически важной для работы с памятью в ассемблере. Она позволяет загружать данные из различных областей памяти в регистры, что является основой для большинства операций в программах на низком уровне. Понимание различных способов использования команды `ldr` позволяет писать эффективный и оптимизированный код, работающий напрямую с аппаратурой процессора.