---
title: Спецификаторы операндов в GCC Inline Assembly
---
![[Пояснение % %]]

В GCC встроенный ассемблер использует спецификаторы операндов для указания типа данных, которые будут использоваться в инструкциях. Эти спецификаторы помогают компилятору понять, как обращаться с операндами в ассемблерных вставках. Рассмотрим основные спецификаторы операндов и их использование.

#### 1. "m"
- **Описание**: Указывает, что операнд находится в памяти.
- **Пример**: `[array_ptr] "m"(array_ptr)`

Пример использования:
```c
int array[5] = {1, 2, 3, 4, 5};
__asm__(
    "mov (%[arr]), %%eax;"
    :
    : [arr] "m"(array)
    : "eax"
);
```
Здесь `%[arr]` указывает на адрес массива в памяти, и `mov` копирует значение из этого адреса в регистр [[eax]].

#### 2. "r"
- **Описание**: Указывает, что операнд находится в регистре.
- **Пример**: `[N] "r"(n)`

Пример использования:
```c
int n = 10;
__asm__(
    "mov %[val], %%eax;"
    :
    : [val] "r"(n)
    : "eax"
);
```
Здесь `%[val]` указывает на переменную `n`, которая загружается в регистр [[eax]].

#### 3. "i"
- **Описание**: Указывает, что операнд является немедленным значением (константой).
- **Пример**: `$1` в команде `mov $1, %ecx`

Пример использования:
```c
__asm__(
    "mov $1, %%ecx;"
);
```
Здесь `$1` указывает на константу 1, которая загружается в регистр [[ecx]].

#### 4. "g"
- **Описание**: Указывает, что операнд может быть любым (регистр, память или немедленное значение).
- **Пример**: `[val] "g"(value)`

Пример использования:
```c
int value = 20;
__asm__(
    "mov %[val], %%eax;"
    :
    : [val] "g"(value)
    : "eax"
);
```
Здесь `%[val]` указывает на переменную `value`, которая может быть размещена в регистре или памяти, в зависимости от оптимизации компилятора.

#### 5. "a"
- **Описание**: Указывает на регистр [[eax]] (или [[rax]] в 64-битных системах).
- **Пример**: `[val] "a"(value)`

Пример использования:
```c
int value = 5;
__asm__(
    "mov %[val], %%eax;"
    :
    : [val] "a"(value)
    : "eax"
);
```
Здесь `%[val]` указывает на переменную `value`, которая загружается в регистр [[eax]].

#### 6. "b"
- **Описание**: Указывает на регистр [[ebx]] (или [[rbx]] в 64-битных системах).
- **Пример**: `[val] "b"(value)`

Пример использования:
```c
int value = 15;
__asm__(
    "mov %[val], %%ebx;"
    :
    : [val] "b"(value)
    : "ebx"
);
```
Здесь `%[val]` указывает на переменную `value`, которая загружается в регистр [[ebx]].

#### 7. "c"
- **Описание**: Указывает на регистр [[ecx]] (или [[rcx]] в 64-битных системах).
- **Пример**: `[val] "c"(value)`

Пример использования:
```c
int value = 25;
__asm__(
    "mov %[val], %%ecx;"
    :
    : [val] "c"(value)
    : "ecx"
);
```
Здесь `%[val]` указывает на переменную `value`, которая загружается в регистр [[ecx]].

#### 8. "d"
- **Описание**: Указывает на регистр [[edx]] (или [[rdx]] в 64-битных системах).
- **Пример**: `[val] "d"(value)`

Пример использования:
```c
int value = 35;
__asm__(
    "mov %[val], %%edx;"
    :
    : [val] "d"(value)
    : "edx"
);
```
Здесь `%[val]` указывает на переменную `value`, которая загружается в регистр [[edx]].

#### 9. "S"
- **Описание**: Указывает на регистр [[esi]] (или [[rsi]] в 64-битных системах).
- **Пример**: `[src] "S"(source)`

Пример использования:
```c
int source = 45;
__asm__(
    "mov %[src], %%esi;"
    :
    : [src] "S"(source)
    : "esi"
);
```
Здесь `%[src]` указывает на переменную `source`, которая загружается в регистр [[esi]].

#### 10. "D"
- **Описание**: Указывает на регистр [[edi]] (или [[rdi]] в 64-битных системах).
- **Пример**: `[dst] "D"(destination)`

Пример использования:
```c
int destination = 55;
__asm__(
    "mov %[dst], %%edi;"
    :
    : [dst] "D"(destination)
    : "edi"
);
```
Здесь `%[dst]` указывает на переменную `destination`, которая загружается в регистр [[edi]].

### Комбинирование спецификаторов

Встроенный ассемблер позволяет комбинировать разные спецификаторы для более гибкого управления операндами.

#### Пример: Комбинирование спецификаторов

```c
int a = 5, b = 10, result;
__asm__(
    "mov %[input_a], %%eax;"
    "add %[input_b], %%eax;"
    "mov %%eax, %[output];"
    : [output] "=m"(result)
    : [input_a] "r"(a), [input_b] "r"(b)
    : "eax"
);
```

Здесь:
- `"=m"` указывает, что операнд будет записан в память (`result`) ([[Символ = в спецификаторах операндов|Что означает =?]]).
- `"r"` указывает, что входные операнды будут загружены в регистры (`a` и `b`).

### Заключение

Спецификаторы операндов в GCC встроенном ассемблере играют важную роль в управлении тем, как компилятор обрабатывает операнды в ассемблерных вставках. Понимание этих спецификаторов позволяет писать более эффективный и оптимизированный код, интегрируя ассемблерные инструкции с кодом на C.